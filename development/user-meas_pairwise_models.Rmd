---
title: "user-meas pairwise models"
output: html_document
---

```{r packages, echo = F, warning = F, message = F}
library(tidyverse)
library(gridExtra)
library(lme4)
```

```{r}
pairwise_data <- readRDS("../data/user_meas_pairwise.rda")


pairwise_data <- pairwise_data %>% 
  mutate(operator_truth = ifelse(Operator_S1 == Operator_S2, 
                                 "Same Operator", "Diff Operator"), 
         bullet_truth = ifelse(Bullet_S1 == Bullet_S2,
                               "Same Bullet", "Diff Bullet"),
         machine_truth = ifelse(Machine_S1 == Machine_S2,
                                "Same Machine", "Diff Machine"),
         round_truth = ifelse(Round_S1 == Round_S2,
                              "Same Round", "Diff Round"))
head(pairwise_data)
```

```{r}
pairwise_data %>% 
  ggplot() + geom_density(aes(x = rfscore, fill = factor(ground_truth)), alpha = 0.5) + 
  theme_bw() + 
  scale_fill_manual(name = "", breaks = c("Different Source", "Same Source"), 
                     labels = c("Different Source", "Same Source"), 
                     limits=c("Different Source","Same Source"), 
                     values = c("grey80", "darkorange")) + 
  facet_wrap(~operator_truth, nrow = 2) + 
  labs(x = "Random Forest Score", y = "", title = "User measurements set Land-to-Land Results")
```


```{r}
pairwise_data %>% 
  ggplot() + geom_density(aes(x = rfscore, fill = factor(operator_truth)), alpha = 0.5) + 
  theme_bw() + 
  scale_fill_manual(name = "", breaks = c("Diff Operator", "Same Operator"), 
                     labels = c("Diff Operator", "Same Operator"), 
                     limits=c("Diff Operator","Same Operator"), 
                     values = c("grey80", "darkorange")) + 
  facet_wrap(~machine_truth, nrow = 2) + 
  labs(x = "Random Forest Score", y = "", title = "User measurements set Land-to-Land Results")
```


```{r}
pairwise_data_b6 <- pairwise_data %>%
  filter(Barrel_S1 == "Barrel 6" & Barrel_S2 == "Barrel 6") %>%
  filter(ground_truth == "Same Source") 


pair_op_model <- lmer(rfscore ~ unique_id_S1 + (1|bullet_truth/unique_id_S1) + 
                        (1|operator_truth/unique_id_S1) + (1|machine_truth/unique_id_S1) + 
                        (1|operator_truth:bullet_truth) + (1|machine_truth:bullet_truth),
                  data = pairwise_data_b6)

pair_op_base <- lmer(rfscore~unique_id_S1 + (1|bullet_truth/unique_id_S1), 
                      data = pairwise_data_b6)

summary(pair_op_model)
```




